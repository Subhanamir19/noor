import type { AgeGroup } from '@/types/models';
import type { CoreTraitId } from '@/data/characterScenarios';

export type PracticeDifficulty = 1 | 1.5 | 2;

export interface TraitPractice {
  id: string;
  traitId: CoreTraitId;
  title: string;
  goal: string;
  when_to_use: string;
  age_appropriate: AgeGroup;
  duration_minutes: number;
  difficulty: PracticeDifficulty;
  steps: string[]; // 3–5 items
  what_to_say: string[]; // short parent scripts
  if_child_resists: string;
  reflection_prompts: string[];
  safety_note?: string;
}

export const TRAIT_PRACTICES: ReadonlyArray<TraitPractice> = Object.freeze([
  // =====================================================
  // HONESTY (sidq)
  // =====================================================
  {
    id: 'sidq_1_truth_first',
    traitId: 'sidq',
    title: 'Truth First',
    goal: 'Make truth feel safe and rewarded.',
    when_to_use: 'Right after a small accident, spill, or mistake.',
    age_appropriate: 'all',
    duration_minutes: 4,
    difficulty: 1,
    steps: ['Ask “What happened?” calmly.', 'Say “Thank you for telling the truth.”', 'Fix it together.'],
    what_to_say: ['“Thank you for telling me the truth.”', '“Truth first, then we fix.”'],
    if_child_resists: 'Give two options: “Show me” or “Tell me”. Keep tone calm.',
    reflection_prompts: ['Did I stay calm first?', 'Did we focus on repair?'],
  },
  {
    id: 'sidq_2_parent_model',
    traitId: 'sidq',
    title: 'Model Honesty',
    goal: 'Teach honesty by seeing you practice it.',
    when_to_use: 'When you make a small mistake in front of them.',
    age_appropriate: 'child',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Name a small mistake you made.', 'Say how you will fix it.', 'Invite your child to help.'],
    what_to_say: ['“I made a mistake.”', '“I will fix it like this…”'],
    if_child_resists: 'Model it anyway; the lesson still lands.',
    reflection_prompts: ['Did modeling reduce fear?', 'What did my child notice?'],
  },
  {
    id: 'sidq_3_truth_or_pretend',
    traitId: 'sidq',
    title: 'Truth or Pretend',
    goal: 'Separate imagination from lying (no shame).',
    when_to_use: 'During playtime when pretend stories happen.',
    age_appropriate: 'toddler',
    duration_minutes: 6,
    difficulty: 1,
    steps: ['Explain truth vs pretend.', 'Play 4 quick examples.', 'Praise the effort.'],
    what_to_say: ['“Was that real or pretend?”', '“Pretend is for play, truth is for real life.”'],
    if_child_resists: 'Do just 2 rounds and stop while it’s fun.',
    reflection_prompts: ['Did I avoid labels like “liar”?', 'Did clarity help?'],
  },
  {
    id: 'sidq_4_truth_then_repair',
    traitId: 'sidq',
    title: 'Truth + Fix',
    goal: 'Link honesty with making things right.',
    when_to_use: 'When something breaks or someone gets hurt and repair is needed.',
    age_appropriate: 'child',
    duration_minutes: 8,
    difficulty: 1.5,
    steps: ['Listen 10 seconds.', 'Thank them for truth.', 'Choose one small repair action.'],
    what_to_say: ['“Thank you for telling me.”', '“How can we fix it?”'],
    if_child_resists: 'Offer a repair menu: clean / apologize / replace / help.',
    reflection_prompts: ['Did repair feel doable?', 'Did I keep shame out of my tone?'],
  },
  {
    id: 'sidq_5_one_true_thing',
    traitId: 'sidq',
    title: 'One True Thing',
    goal: 'Build a small daily honesty habit.',
    when_to_use: 'At bedtime or during a calm daily check-in.',
    age_appropriate: 'all',
    duration_minutes: 4,
    difficulty: 1.5,
    steps: ['At bedtime ask for 1 true thing.', 'You share 1 too.', 'End warmly.'],
    what_to_say: ['"Tell me one true thing from today."', '"I love when we share honestly."'],
    if_child_resists: 'You go first; let them answer later or with pointing.',
    reflection_prompts: ['What time of day works best?', 'Did bedtime sharing help daytime truth?'],
  },
  {
    id: 'sidq_6_hand_on_heart',
    traitId: 'sidq',
    title: 'Hand on Heart (truth)',
    goal: 'Make telling the truth feel calm and simple.',
    when_to_use: 'When they hesitate to answer or feel nervous.',
    age_appropriate: 'toddler',
    duration_minutes: 6,
    difficulty: 1,
    steps: [
      'Teach the sign: hand on heart means "I tell the truth".',
      'Practice 3 pretend questions.',
      'Use it once in real life.',
    ],
    what_to_say: ['Hand on heart. Tell me the truth.', 'Thank you for telling me.'],
    if_child_resists: 'Do it with a toy first. Keep it playful, not scary.',
    reflection_prompts: ['Did the sign make truth easier?', 'Did I stay calm when I asked?'],
  },

  // =====================================================
  // GENEROSITY (karam)
  // =====================================================
  {
    id: 'karam_1_share_with_choice',
    traitId: 'karam',
    title: 'Share With Choice',
    goal: 'Practice sharing without force.',
    when_to_use: 'During toy conflicts or when sharing feels hard.',
    age_appropriate: 'all',
    duration_minutes: 6,
    difficulty: 1,
    steps: ['Offer “share now or in 5 minutes”.', 'Let child choose how much/which toy.', 'Praise specifically.'],
    what_to_say: ['“You choose: now or after 5 minutes.”', '“That was generous.”'],
    if_child_resists: 'Start tiny: one piece/one turn. Build slowly.',
    reflection_prompts: ['Did choice reduce conflict?', 'What was “tiny sharing” today?'],
  },
  {
    id: 'karam_2_one_small_gift',
    traitId: 'karam',
    title: 'One Small Gift',
    goal: 'Make giving real.',
    when_to_use: 'On a weekend or when you can step out together.',
    age_appropriate: 'child',
    duration_minutes: 12,
    difficulty: 2,
    steps: ['Pick a person to brighten.', 'Choose a small item/note.', 'Deliver/send together.'],
    what_to_say: ['“Who can we make happy today?”', '“Giving is a strong heart.”'],
    if_child_resists: 'Let it be “from you” first; next time invite their choice.',
    reflection_prompts: ['Did choosing or delivering feel better?', 'Who is next?'],
  },
  {
    id: 'karam_3_others_first',
    traitId: 'karam',
    title: 'Others First (1 moment)',
    goal: 'Build a quick giving habit.',
    when_to_use: 'At snack time or when there is something desirable.',
    age_appropriate: 'all',
    duration_minutes: 4,
    difficulty: 1.5,
    steps: ['At snack, ask who goes first.', 'Let child choose someone else once.', 'Celebrate the act.'],
    what_to_say: ['“Who should get the first piece?”', '“That was generous.”'],
    if_child_resists: 'Start with “mom first or you first?” then expand later.',
    reflection_prompts: ['Which moments fit “others first”?', 'Did modeling help?'],
  },
  {
    id: 'karam_4_generous_words',
    traitId: 'karam',
    title: 'Generous Words',
    goal: 'Give kindness through encouragement.',
    when_to_use: 'When you notice effort, not perfection.',
    age_appropriate: 'child',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Pick one person at home.', 'Help child say one kind sentence.', 'Repeat once if easy.'],
    what_to_say: ['“Let’s give a kind-word gift.”', '“Say: I like when you…”'],
    if_child_resists: 'Let them draw a smiley or give a high-five instead.',
    reflection_prompts: ['What kind words felt natural?', 'Did it shift the mood?'],
  },
  {
    id: 'karam_5_giving_box',
    traitId: 'karam',
    title: 'Family Giving Box',
    goal: 'Create a simple giving habit.',
    when_to_use: "Once a week before Jumu'ah or on family day.",
    age_appropriate: 'toddler',
    duration_minutes: 10,
    difficulty: 1.5,
    steps: ['Find a box/jar.', 'Decorate/label "Giving".', 'Add one item together.'],
    what_to_say: ['"This is our giving box."', '"We give a little."'],
    if_child_resists: 'You add the first item; let them decorate the box.',
    reflection_prompts: ['Did the habit feel fun?', 'When will we donate?'],
  },
  {
    id: 'karam_6_first_bite',
    traitId: 'karam',
    title: 'First Bite Gift',
    goal: 'Practice giving with one tiny action.',
    when_to_use: 'At meals or snacks to build the habit.',
    age_appropriate: 'toddler',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['At snack, hold one small piece.', 'Ask: "Who should we give first?"', 'Give it, then say Alhamdulillah.'],
    what_to_say: ['Let\'s give first.', 'That was generous.'],
    if_child_resists: 'You do it once first. Then ask them to copy one small piece.',
    reflection_prompts: ['Was the step tiny enough?', 'Did doing it first help?'],
  },

  // =====================================================
  // PATIENCE (sabr)
  // =====================================================
  {
    id: 'sabr_1_pause_two_breaths',
    traitId: 'sabr',
    title: 'Pause + Two Breaths',
    goal: 'Give a simple body tool for patience.',
    when_to_use: 'Right before a transition or when emotions rise.',
    age_appropriate: 'all',
    duration_minutes: 4,
    difficulty: 1,
    steps: ['Practice “pause” hand signal.', 'Take two slow breaths together.', 'Use it once in a real moment.'],
    what_to_say: ['“Pause.”', '“One breath… two breaths… now we choose.”'],
    if_child_resists: 'Do it yourself first; invite them to copy once.',
    reflection_prompts: ['Did I prompt early enough?', 'What triggers need earlier support?'],
  },
  {
    id: 'sabr_2_timer_waiting',
    traitId: 'sabr',
    title: 'Waiting Practice (timer)',
    goal: 'Build waiting skill in tiny doses.',
    when_to_use: 'Before a desired thing (snack, screen, toy).',
    age_appropriate: 'all',
    duration_minutes: 6,
    difficulty: 1.5,
    steps: ['Set a 30–60 sec timer.', 'Say “we wait for the beep”.', 'Cheer the waiting.'],
    what_to_say: ['“We wait until the beep.”', '“You waited—patience!”'],
    if_child_resists: 'Lower to 10 seconds and grow slowly over days.',
    reflection_prompts: ['What wait length worked?', 'Did the timer reduce meltdowns?'],
  },
  {
    id: 'sabr_3_two_choices',
    traitId: 'sabr',
    title: 'Wait + Choose',
    goal: 'Reduce fights by giving two choices.',
    when_to_use: 'When you feel a power struggle starting.',
    age_appropriate: 'child',
    duration_minutes: 7,
    difficulty: 2,
    steps: ['Name the limit: "not yet".', 'Offer two choices.', 'Do what you said.'],
    what_to_say: ['“Not yet. Choose: __ now or __ later.”', '“Thank you for waiting.”'],
    if_child_resists: 'Offer one choice and stay calm: "I know you really want it."',
    reflection_prompts: ['Did choices calm things?', 'Did I follow through?'],
  },
  {
    id: 'sabr_4_patience_story',
    traitId: 'sabr',
    title: 'Patience Story',
    goal: 'Teach patience with a short story.',
    when_to_use: 'At bedtime or after a tough moment.',
    age_appropriate: 'toddler',
    duration_minutes: 8,
    difficulty: 1,
    steps: ['Tell a short story: want, wait, try, result.', 'Ask "What helped?"', 'Name the tool.'],
    what_to_say: ['“First we wanted it, then we waited…”', '“That’s patience.”'],
    if_child_resists: 'Act it out with toys for 30 seconds.',
    reflection_prompts: ['Story or breathing works better?', 'What story felt relatable?'],
  },
  {
    id: 'sabr_5_catch_patience',
    traitId: 'sabr',
    title: 'Catch Patience',
    goal: 'Grow patience by noticing it.',
    when_to_use: 'Any time you see even a tiny wait.',
    age_appropriate: 'child',
    duration_minutes: 5,
    difficulty: 1.5,
    steps: ['Watch for tiny patience.', 'Name it right away.', 'Praise it clearly.'],
    what_to_say: ['"You waited-that\'s patience."', '"You stayed calm-well done."'],
    if_child_resists: 'Praise quietly without demanding a response.',
    reflection_prompts: ['When did I notice patience?', 'Did it increase repeats?'],
  },
  {
    id: 'sabr_6_sabr_fingers',
    traitId: 'sabr',
    title: 'Sabr Fingers (1-2-3)',
    goal: 'Give a simple patience tool they can copy.',
    when_to_use: 'When they are about to rush, grab, or interrupt.',
    age_appropriate: 'toddler',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Show 3 fingers.', 'Count slowly: 1...2...3.', 'Do it once before a hard moment.'],
    what_to_say: ['Sabr fingers: 1, 2, 3.', 'Now we can try again.'],
    if_child_resists: 'Do it yourself first. Let them watch without pressure.',
    reflection_prompts: ['Did the tool help before a meltdown?', 'When should I prompt earlier?'],
  },

  // =====================================================
  // KINDNESS (rahma)
  // =====================================================
  {
    id: 'rahma_1_kind_hands',
    traitId: 'rahma',
    title: 'Kind Hands',
    goal: 'Turn kindness into a cue you can use fast.',
    when_to_use: 'During sibling conflict or rough play.',
    age_appropriate: 'all',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Show “kind hands”.', 'Practice gentle touch (high-five / pat).', 'Use cue once in conflict.'],
    what_to_say: ['“Kind hands, kind words.”', '“Try again with kindness.”'],
    if_child_resists: 'Model it on yourself and praise any tiny attempt.',
    reflection_prompts: ['Did the cue help calm things down?', 'Where do we need earlier help?'],
  },
  {
    id: 'rahma_2_help_one_person',
    traitId: 'rahma',
    title: 'Help One Person',
    goal: 'Make kindness practical and visible.',
    when_to_use: 'During errands or around the home.',
    age_appropriate: 'child',
    duration_minutes: 10,
    difficulty: 1.5,
    steps: ['Pick one helpful act.', 'Do it together once.', 'Let child do the last step.'],
    what_to_say: ['“We help because we care.”', '“That was kind—thank you.”'],
    if_child_resists: 'Offer two easy options and let them pick.',
    reflection_prompts: ['Which help act was easiest?', 'Did doing it together make it easier?'],
  },
  {
    id: 'rahma_3_kindness_commentary',
    traitId: 'rahma',
    title: 'Kindness Commentary',
    goal: 'Grow kindness by talking about it.',
    when_to_use: 'On walks or while reading/watching together.',
    age_appropriate: 'toddler',
    duration_minutes: 6,
    difficulty: 1,
    steps: ['Pick a 5-min window.', 'Narrate kind actions you see.', 'Label: “That’s kindness.”'],
    what_to_say: ['“That was gentle.”', '“That was kindness.”'],
    if_child_resists: 'Narrate without expecting a response; it’s input.',
    reflection_prompts: ['What kindness did we already do?', 'Did talking about it help?'],
  },
  {
    id: 'rahma_4_kind_repair',
    traitId: 'rahma',
    title: 'Kind Repair',
    goal: 'Teach kindness through repair after harm.',
    when_to_use: 'After hurting someone or breaking a rule.',
    age_appropriate: 'child',
    duration_minutes: 10,
    difficulty: 2,
    steps: ['Name impact briefly.', 'Ask “How can we fix it?”', 'Do one repair now.'],
    what_to_say: ['“We fix what we hurt.”', '“Say: Are you okay?”'],
    if_child_resists: 'Start with repair action without words (help, water, space).',
    reflection_prompts: ['Was repair simple and immediate?', 'Did I keep shame out of it?'],
  },
  {
    id: 'rahma_5_name_feelings',
    traitId: 'rahma',
    title: 'Name Feelings + Help',
    goal: 'Build care by noticing feelings.',
    when_to_use: 'During tears, frustration, or big feelings.',
    age_appropriate: 'all',
    duration_minutes: 7,
    difficulty: 1.5,
    steps: ['Notice someone upset.', 'Name feeling gently.', 'Try one small help action.'],
    what_to_say: ['"They look __. What could help?"', '"A kind word can change a day."'],
    if_child_resists: 'Offer one simple line: "Are you okay?"',
    reflection_prompts: ['Did naming feelings build care?', 'What words felt easy to say?'],
  },
  {
    id: 'rahma_6_gentle_with_toy',
    traitId: 'rahma',
    title: 'Gentle With a Toy',
    goal: 'Practice mercy with hands and words.',
    when_to_use: 'During playtime with stuffed animals or toys.',
    age_appropriate: 'toddler',
    duration_minutes: 7,
    difficulty: 1,
    steps: ['Pick a stuffed toy.', 'Show "gentle hands" and "soft voice".', 'Do one caring act: hug, cover, or give water.'],
    what_to_say: ['Gentle hands.', 'We are kind and gentle.'],
    if_child_resists: 'You do it first. Let them copy one small step.',
    reflection_prompts: ['Was my tone gentle too?', 'What caring action felt easiest?'],
  },

  // =====================================================
  // COURAGE (courage)
  // =====================================================
  {
    id: 'courage_1_tiny_brave_try',
    traitId: 'courage',
    title: 'Tiny Brave Try',
    goal: 'Practice courage in a safe, small step.',
    when_to_use: 'When they avoid something small (hello, slide, try).',
    age_appropriate: 'all',
    duration_minutes: 8,
    difficulty: 1,
    steps: ['Ask what feels a little scary.', 'Pick the smallest version.', 'Celebrate the attempt.'],
    what_to_say: ['“It’s okay to feel scared.”', '“Trying anyway is courage.”'],
    if_child_resists: 'Lower the step: look / stand near / touch.',
    reflection_prompts: ['What small brave step worked?', 'Did I praise effort over outcome?'],
    safety_note: 'Avoid forcing; keep it gentle and child-led.',
  },
  {
    id: 'courage_2_brave_phrase',
    traitId: 'courage',
    title: 'Brave Phrase',
    goal: 'Give a short brave phrase.',
    when_to_use: 'Right before a nervous moment.',
    age_appropriate: 'toddler',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Pick a phrase.', 'Say it 3 times with “brave posture”.', 'Use it once today.'],
    what_to_say: ['“I can try.”', '“Allah is with me.”'],
    if_child_resists: 'Let them pick a funny phrase; keep it playful.',
    reflection_prompts: ['Did the phrase help before a challenge?', 'What gesture helped most?'],
  },
  {
    id: 'courage_3_courage_ladder',
    traitId: 'courage',
    title: 'Courage Ladder (2 steps)',
    goal: 'Break fear into two doable steps.',
    when_to_use: 'When a fear repeats (doctor, dark, new class).',
    age_appropriate: 'child',
    duration_minutes: 10,
    difficulty: 2,
    steps: ['Define Step 1 (easy).', 'Do Step 1 today.', 'Plan Step 2 tomorrow.'],
    what_to_say: ['“We do courage in steps.”', '“Today Step 1, tomorrow Step 2.”'],
    if_child_resists: 'Make Step 1 even smaller; success is “approach”.',
    reflection_prompts: ['Was the ladder small enough?', 'Did planning reduce pressure?'],
    safety_note: 'Keep steps safe; don’t push into panic.',
  },
  {
    id: 'courage_4_brave_story',
    traitId: 'courage',
    title: 'Brave Story Replay',
    goal: 'Build courage by recalling past bravery.',
    when_to_use: 'After they do something hard, to reinforce it.',
    age_appropriate: 'all',
    duration_minutes: 6,
    difficulty: 1.5,
    steps: ['Recall a brave moment.', 'Describe it warmly.', 'Name what helped.'],
    what_to_say: ['“You were scared and still tried.”', '“That’s courage.”'],
    if_child_resists: 'Tell the story anyway; it helps them believe they can do it.',
    reflection_prompts: ['What courage tool did we name?', 'Can we reuse it next time?'],
  },
  {
    id: 'courage_5_brave_choice',
    traitId: 'courage',
    title: 'Brave Choice',
    goal: 'Offer a choice so courage feels safe.',
    when_to_use: 'When you need cooperation but want to keep safety.',
    age_appropriate: 'child',
    duration_minutes: 7,
    difficulty: 1.5,
    steps: ['Offer two small brave options.', 'Let child choose.', 'Praise the choice.'],
    what_to_say: ['"You choose: __ or __."', '"Choosing brave is courage."'],
    if_child_resists: 'Let them watch you do it once; ask for 10% next time.',
    reflection_prompts: ['Did choice increase willingness?', 'Which option fit our day?'],
  },
  {
    id: 'courage_6_brave_salaam',
    traitId: 'courage',
    title: 'Brave Salaam',
    goal: 'Practice courage by saying salaam first.',
    when_to_use: 'At the masjid, park, or family gathering.',
    age_appropriate: 'toddler',
    duration_minutes: 6,
    difficulty: 1,
    steps: ['Practice salaam at home 3 times.', 'Pick one safe person (family/neighbor).', 'Say salaam with a smile.'],
    what_to_say: ['Let\'s say: Assalamu alaikum.', 'You did a brave hello.'],
    if_child_resists: 'Start with a wave. You say salaam first.',
    reflection_prompts: ['Who felt easiest to greet?', 'Did practicing at home help?'],
  },

  // =====================================================
  // GRATITUDE (shukr)
  // =====================================================
  {
    id: 'shukr_1_three_blessings',
    traitId: 'shukr',
    title: 'Three Blessings',
    goal: 'Practice noticing blessings daily.',
    when_to_use: 'At bedtime or during dinner.',
    age_appropriate: 'all',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Pick a time (dinner/bed).', 'Each person names 1 good thing.', 'Repeat until 3.'],
    what_to_say: ['“What’s one good thing today?”', '“Alhamdulillah for __.”'],
    if_child_resists: 'Offer categories: food / people / fun / body / home.',
    reflection_prompts: ['What time works best?', 'Did it shift the mood?'],
  },
  {
    id: 'shukr_2_thank_a_person',
    traitId: 'shukr',
    title: 'Thank a Person',
    goal: 'Build the habit of thanking people.',
    when_to_use: 'Right after someone helps (family, teacher, friend).',
    age_appropriate: 'all',
    duration_minutes: 6,
    difficulty: 1.5,
    steps: ['Pick one person to thank.', 'Say or send “thank you”.', 'Praise the effort.'],
    what_to_say: ['“Let’s thank __ for __.”', '“That’s gratitude.”'],
    if_child_resists: 'Use a gesture: wave, hug, or a drawing instead of words.',
    reflection_prompts: ['Who was easiest to thank?', 'Did I model it first?'],
  },
  {
    id: 'shukr_3_complaint_to_okay',
    traitId: 'shukr',
    title: 'Complaint + One Okay Thing',
    goal: 'Gently redirect complaining into gratitude.',
    when_to_use: 'When complaining starts to spiral.',
    age_appropriate: 'child',
    duration_minutes: 8,
    difficulty: 2,
    steps: ['Listen first.', 'Ask for one thing that is okay.', 'Name it together.'],
    what_to_say: ['“I hear you. That’s hard.”', '“What is one thing that’s okay right now?”'],
    if_child_resists: 'Offer your example first: “Even though __, I’m thankful for __.”',
    reflection_prompts: ['Did I listen first?', 'Did my redirect calm things down?'],
  },
  {
    id: 'shukr_4_blessing_hunt',
    traitId: 'shukr',
    title: 'Blessing Hunt',
    goal: 'Make gratitude playful and concrete.',
    when_to_use: 'On a walk or in the car.',
    age_appropriate: 'toddler',
    duration_minutes: 10,
    difficulty: 1,
    steps: ['Say “find 3 blessings”.', 'Walk and point to items.', 'Say “Alhamdulillah”.'],
    what_to_say: ['“Alhamdulillah for our water.”', '“Alhamdulillah for our home.”'],
    if_child_resists: 'Do only 2 blessings and stop while it’s fun.',
    reflection_prompts: ['What blessings did my child notice?', 'Did play reduce entitlement?'],
  },
  {
    id: 'shukr_5_gratitude_note',
    traitId: 'shukr',
    title: 'One Gratitude Note',
    goal: 'Turn gratitude into action.',
    when_to_use: 'After a good moment; send to someone.',
    age_appropriate: 'child',
    duration_minutes: 12,
    difficulty: 1.5,
    steps: ['Pick a person.', 'Write/voice 1-2 lines.', 'Send it together.'],
    what_to_say: ['"Thank you for __."', '"We appreciate you."'],
    if_child_resists: 'Let them draw a heart or pick a sticker.',
    reflection_prompts: ['How did it feel to express gratitude?', 'Who next time?'],
  },
  {
    id: 'shukr_6_alhamdulillah_echo',
    traitId: 'shukr',
    title: 'Alhamdulillah Echo',
    goal: 'Make gratitude easy with repeat-after-me.',
    when_to_use: 'During routine moments (meal, leaving home, bedtime).',
    age_appropriate: 'toddler',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Pick 3 simple things (water, bed, food).', 'Say: "Alhamdulillah for __."', 'Let your child repeat or point.'],
    what_to_say: ['Alhamdulillah for our food.', 'Alhamdulillah for our home.'],
    if_child_resists: 'Let them just point. You say the words.',
    reflection_prompts: ['Which words were easiest to repeat?', 'What time of day worked best?'],
  },

  // =====================================================
  // RESPECT (respect)
  // =====================================================
  {
    id: 'respect_1_polite_request',
    traitId: 'respect',
    title: 'Polite Requests',
    goal: 'Practice respectful words during routine asks.',
    when_to_use: 'During daily requests (water, toys, help).',
    age_appropriate: 'all',
    duration_minutes: 6,
    difficulty: 1,
    steps: ['Model: “Please may I have __?”', 'Child repeats once.', 'Praise respectful ask.'],
    what_to_say: ['“Try: please may I have __?”', '“That was respectful—thank you.”'],
    if_child_resists: 'Accept any respectful version; tone matters most.',
    reflection_prompts: ['Which routine moment fits best?', 'Did praising tone help?'],
  },
  {
    id: 'respect_2_talking_object',
    traitId: 'respect',
    title: 'Listen, Then Speak',
    goal: 'Build turn-taking and listening.',
    when_to_use: 'During family conversation or conflict.',
    age_appropriate: 'child',
    duration_minutes: 10,
    difficulty: 2,
    steps: ['Use a “talking object”.', 'Holder speaks 20 seconds.', 'Switch twice.'],
    what_to_say: ['“Your turn to speak. My turn to listen.”', '“Listening is respect.”'],
    if_child_resists: 'Lower to 10 seconds; keep it playful.',
    reflection_prompts: ['Did it reduce interruptions?', 'Do we need shorter turns?'],
  },
  {
    id: 'respect_3_respectful_redo',
    traitId: 'respect',
    title: 'Respectful Re-do',
    goal: 'Correct disrespect without shame.',
    when_to_use: 'When disrespectful words come out.',
    age_appropriate: 'child',
    duration_minutes: 5,
    difficulty: 1.5,
    steps: ['Pause after disrespect.', 'Say “try again respectfully”.', 'Praise the re-do.'],
    what_to_say: ['“Try again with a calm voice.”', '“Thank you for re-doing it.”'],
    if_child_resists: 'You model once: “I’ll show you.” Then ask for one word.',
    reflection_prompts: ['Did the re-do calm things down?', 'Did I stay calm?'],
  },
  {
    id: 'respect_4_honor_elders',
    traitId: 'respect',
    title: 'Honor Elders (micro)',
    goal: 'Practice respect for elders with one small action.',
    when_to_use: 'Before visiting grandparents, elders, or guests.',
    age_appropriate: 'all',
    duration_minutes: 7,
    difficulty: 1,
    steps: ['Pick one elder.', 'Practice greeting/service.', 'Do it once today.'],
    what_to_say: ['“Let’s greet with salaam and a smile.”', '“We honor elders with kindness.”'],
    if_child_resists: 'Start with a wave or quiet salaam; don’t force contact.',
    reflection_prompts: ['What action felt easiest?', 'How did they respond?'],
  },
  {
    id: 'respect_5_care_for_things',
    traitId: 'respect',
    title: 'Care for Belongings',
    goal: 'Teach respect through gentle care.',
    when_to_use: 'During cleanup or before leaving a place.',
    age_appropriate: 'toddler',
    duration_minutes: 8,
    difficulty: 1.5,
    steps: ['Pick 3 items.', 'Put away with "gentle hands".', 'Praise careful handling.'],
    what_to_say: ['"We respect things by caring for them."', '"Gentle hands."'],
    if_child_resists: 'Make it a short game: "3 items before I count to 10."',
    reflection_prompts: ['Did structure help?', 'What item is hardest to treat gently?'],
  },
  {
    id: 'respect_6_look_and_listen',
    traitId: 'respect',
    title: 'Look + Listen (5 seconds)',
    goal: 'Practice respectful listening in tiny steps.',
    when_to_use: 'Before giving an instruction or during reminders.',
    age_appropriate: 'toddler',
    duration_minutes: 5,
    difficulty: 1,
    steps: ['Say: "Look at my eyes."', 'Count slowly to 5.', 'Say: "Thank you for listening."'],
    what_to_say: ['Look and listen.', 'Thank you for listening.'],
    if_child_resists: 'Start with 2 seconds. Praise any tiny try.',
    reflection_prompts: ['Was 5 seconds too long?', 'Did I praise quickly?'],
  },

  // =====================================================
  // RESPONSIBILITY (responsibility)
  // =====================================================
  {
    id: 'responsibility_1_one_job',
    traitId: 'responsibility',
    title: 'One Job (owned)',
    goal: 'Give one small responsibility they fully own.',
    when_to_use: 'When establishing a new routine.',
    age_appropriate: 'all',
    duration_minutes: 10,
    difficulty: 1,
    steps: ['Pick one job (shoes/napkins/toys).', 'Name it as “your job”.', 'Do it together once.'],
    what_to_say: ['“This is your job. I trust you.”', '“You did your job—responsible!”'],
    if_child_resists: 'Make it one step only (e.g., shoes on the rack).',
    reflection_prompts: ['Was it small enough?', 'Do reminders help or annoy?'],
  },
  {
    id: 'responsibility_2_cleanup_timer',
    traitId: 'responsibility',
    title: 'Clean-Up Timer',
    goal: 'Make responsibility doable with a short time box.',
    when_to_use: 'When cleanup feels overwhelming.',
    age_appropriate: 'toddler',
    duration_minutes: 6,
    difficulty: 1.5,
    steps: ['Set a 2-minute timer.', 'Clean side-by-side.', 'Stop at the beep and praise.'],
    what_to_say: ['“Two minutes of teamwork.”', '“We stop at the beep—well done.”'],
    if_child_resists: 'Start with 30 seconds; you do it together.',
    reflection_prompts: ['Did the timer make it feel smaller?', 'What time length worked?'],
  },
  {
    id: 'responsibility_3_plan_do_check',
    traitId: 'responsibility',
    title: 'Plan + Do + Check',
    goal: 'Teach a simple responsibility routine.',
    when_to_use: 'Before homework, chores, or a new task.',
    age_appropriate: 'child',
    duration_minutes: 12,
    difficulty: 2,
    steps: ['Ask: “What’s the plan?”', 'Do the first step now.', 'Check: “Did we do the plan?”'],
    what_to_say: ['“What’s your plan?”', '“Let’s do the first step now.”'],
    if_child_resists: 'Use a simple line: "First __, then __."',
    reflection_prompts: ['Did planning reduce delays?', 'What step was hardest?'],
  },
  {
    id: 'responsibility_4_own_it_repair',
    traitId: 'responsibility',
    title: 'Own It + Repair',
    goal: 'Build responsibility through repair (not shame).',
    when_to_use: 'After a mistake or mess.',
    age_appropriate: 'all',
    duration_minutes: 10,
    difficulty: 1.5,
    steps: ['Ask what happened.', 'Ask how to fix it.', 'Do one repair action together.'],
    what_to_say: ['“Mistakes happen. We fix them.”', '“What’s one repair we can do?”'],
    if_child_resists: 'Offer two repairs and let them pick.',
    reflection_prompts: ['Did we focus on repair?', 'Did they accept responsibility more easily?'],
  },
  {
    id: 'responsibility_5_prepare_tomorrow',
    traitId: 'responsibility',
    title: 'Prepare Tomorrow (1 thing)',
    goal: 'Build responsibility by thinking ahead.',
    when_to_use: 'At night before bed.',
    age_appropriate: 'child',
    duration_minutes: 7,
    difficulty: 1.5,
    steps: ['Pick one item to prep.', 'Prep it together.', 'Praise helping tomorrow-you.'],
    what_to_say: ['"We\'re helping tomorrow-you."', '"That\'s responsibility."'],
    if_child_resists: 'Let them choose which single item to prepare.',
    reflection_prompts: ['Did it reduce morning stress?', 'What should we prep next time?'],
  },
  {
    id: 'responsibility_6_shoes_home',
    traitId: 'responsibility',
    title: 'Shoes Have a Home',
    goal: 'Build responsibility with one simple routine.',
    when_to_use: 'At the doorway every day.',
    age_appropriate: 'toddler',
    duration_minutes: 6,
    difficulty: 1,
    steps: ['Pick one spot for shoes.', 'Practice: take off, carry, place.', 'Praise the finish.'],
    what_to_say: ['Shoes go home.', 'You did it all by yourself.'],
    if_child_resists: 'Do it together once. Then ask for one step next time.',
    reflection_prompts: ['Was the spot easy to reach?', 'Did it reduce mess?'],
  },
]);

export function getPracticesForTrait(traitId: CoreTraitId): TraitPractice[] {
  return TRAIT_PRACTICES.filter((p) => p.traitId === traitId);
}

export function filterPracticesByAge(practices: TraitPractice[], age: AgeGroup): TraitPractice[] {
  return practices.filter((p) => p.age_appropriate === 'all' || age === 'all' || p.age_appropriate === age);
}

export function pickRecommendedPractice(
  practices: TraitPractice[],
  age: AgeGroup,
  difficultyTarget: PracticeDifficulty
): { recommended: TraitPractice | null; alternatives: TraitPractice[] } {
  const ageFiltered = filterPracticesByAge(practices, age);
  if (ageFiltered.length === 0) return { recommended: null, alternatives: [] };

  const ageScore = (practice: TraitPractice) => {
    if (age === 'all') return 0;
    if (practice.age_appropriate === age) return 0;
    if (practice.age_appropriate === 'all') return 1;
    return 2;
  };

  const sorted = [...ageFiltered].sort((a, b) => {
    const aa = ageScore(a);
    const ab = ageScore(b);
    if (aa !== ab) return aa - ab;
    const da = Math.abs(a.difficulty - difficultyTarget);
    const db = Math.abs(b.difficulty - difficultyTarget);
    if (da !== db) return da - db;
    return a.duration_minutes - b.duration_minutes;
  });

  const recommended = sorted[0] || null;
  const alternatives = sorted.filter((p) => p.id !== recommended?.id).slice(0, 3);
  return { recommended, alternatives };
}
